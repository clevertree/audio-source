import React from "react";
import PropTypes from 'prop-types';

import './assets/Menu.css';
import MenuManager from "./MenuManager";
import Button from "../button/Button";

class Menu extends Button {

}

class Menu2 extends React.Component {
    constructor(props) {
        super(props);
        this.onInputEventCallback = e => this.onInputEvent(e);
        this.state = {
            open: false,
            stick: false,
            options: null
        };
    }

    render() {
        let className = 'asui-menu';
        if(this.props.disabled)
            className += ' disabled';
        if(this.state.stick)
            className += ' stick';
        if(this.props.className)
            className += ' ' + this.props.className;

        const eventProps = this.getEventProps();

        return (
            <div
                // key={this.props.key}
                className={className}
                title={this.props.title}
                tabIndex={0}
                {...eventProps}
                >
                <div
                    className="title"
                    children={this.props.children}
                    />
                {this.props.arrow ? <div className="arrow">{this.props.arrow}</div> : null}
                {this.state.open ? this.renderDropDown() : null}
            </div>
            );
    }

    renderDropDown() {
        let className = 'asui-menu-dropdown';
        if(this.props.vertical)
            className += ' vertical';
        return (
            <div
                className={className}
                children={this.state.options}
                />
        );
    }


    getEventProps() {
        return {
            onClick: this.onInputEventCallback,
            onKeyDown: this.onInputEventCallback,
        };
    }


    doMenuAction(type='click') {
        if(this.props.disabled) {
            console.warn("Menu is disabled.", this);
            return;
        }
        if(!this.props.onAction)
            throw new Error("prop onAction is missing");
        // e.menu = this;
        const menuAction = {
            // type: e.type,
            type: type,
            menu: this
        };
        const result = this.props.onAction(menuAction, this);
        if(result !== false)
            MenuManager.closeAllMenus(menuAction);
    }

    onInputEvent(e) {
        switch (e.type) {


            case 'click':
                if(!e.isDefaultPrevented()) {
                    e.preventDefault();
                    this.doMenuAction();
                }
                break;

            case 'keydown':

                let keyEvent = e.key;
                switch (keyEvent) {
                    case 'Escape':
                    case 'Backspace':
                        this.closeMenu(e);
                        break;

                    case 'Enter':
                        this.doMenuAction();
                        break;

                    // ctrlKey && metaKey skips a measure. shiftKey selects a range
                    case 'ArrowRight':
                        this.selectNextTabItem(e);
                        break;

                    case 'ArrowLeft':
                        this.selectPreviousTabItem(e);
                        break;

                    case 'ArrowDown':
                        this.selectNextTabItem(e);
                        break;

                    case 'ArrowUp':
                        this.selectPreviousTabItem(e);
                        break;

                    default:
                        console.log("Unknown key input: ", keyEvent);
                        break;

                }
                break;

            default:
                console.log("Unknown input event: ", e.type);
                break;
        }
    }
}

// creating default props
Menu.defaultProps = {
    arrow:          null, // '►',
    vertical:       false,
    openOnHover:    false,
    disabled:       false,
};

// validating prop types
Menu.propTypes = {
    onAction: PropTypes.func.isRequired,
    disabled: PropTypes.bool,
    vertical: PropTypes.bool,
    openOnHover: PropTypes.bool,
};



class MenuHorizontal extends Menu {}
Menu.Horizontal = MenuHorizontal;

/** Default props **/
MenuHorizontal.defaultProps = {
    arrow:          '▼',
    vertical:       true,
    openOnHover:    true,
    disabled:       false,
};

MenuHorizontal.propTypes = Menu.propTypes;



export {
    Menu as default,
    Menu,
    MenuHorizontal
};
